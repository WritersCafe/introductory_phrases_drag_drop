<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Introductory Phrases: Comma or No Comma?</title>

<style>
/* ============================================
   BRAND PALETTE (yours)
============================================ */
:root{
  --pink: #ff6fa9;          /* pink */
  --rose: #f4c2c2;          /* soft rose */
  --latte: #b08968;         /* latte brown */
  --creme: #fff8e7;         /* crème */
  --sage: #7fa37c;          /* sage green */
  --charcoal: #2f3437;      /* charcoal */

  --accent: var(--pink);
  --good: var(--sage);
  --bad: #e22c5a;

  /* ============================================
     POSITIONING — ADJUST HERE (percentages)
     These place the overlays ON TOP of your image.
     Tweak these three to sit perfectly on your design.
  ============================================ */
  --bank-top: 18%;      /* distance from top where your printed bank is */
  --bank-left: 8%;      /* left offset for your bank overlay */
  --bank-width: 28%;    /* width of the bank overlay strip */

  --sentences-top: 46%; /* top edge of the sentences overlay area */
  --sentences-left: 52%;
  --sentences-width: 40%;

  /* Comma visual match — tune color/size/font to match your image commas */
  --comma-color: #c81e3a;              /* deep red/pink to match artwork */
  --comma-font: "Georgia", "Times New Roman", serif;  /* visual match */
  --comma-size: 1.55rem;               /* size of draggable/dropped comma */
}

/* Base */
*{ box-sizing: border-box; }
html, body { height: 100%; }
body{
  margin:0;
  font-family: "Segoe UI", system-ui, -apple-system, Roboto, Arial, sans-serif;
  color: var(--charcoal);
  font-size: 20px;
  line-height: 1.75;
  background: none; /* background is the fixed image below */
}

/* ============================================
   LAYER 1: BACKGROUND IMAGE (your worksheet)
============================================ */
.bg{
  position: fixed;
  inset: 0;
  z-index: -2;
  background-image: url('teen-cafe.png'); /* keep file next to index.html */
  background-size: cover;
  background-position: 60% center; /* shift left/right if needed (55–65%) */
  background-attachment: fixed;
}
/* Keep the art clear—no strong overlay by default */

/* ============================================
   LAYER 2: OVERLAYS (only what's interactive)
============================================ */

/* Sentences overlay region (transparent container) */
#sentencesLayer{
  position: fixed;
  top: var(--sentences-top);
  left: var(--sentences-left);
  width: var(--sentences-width);
  z-index: 10;
}

/* Comma bank overlay region — sits over your printed bank */
#bankLayer{
  position: fixed;
  top: var(--bank-top);
  left: var(--bank-left);
  width: var(--bank-width);
  z-index: 11;
}

/* Optional debug outlines — add ?debug=1 to your URL to see boxes */
.debug #sentencesLayer { outline: 2px dashed #0ea5e9; outline-offset: 2px; }
.debug #bankLayer { outline: 2px dashed #f59e0b; outline-offset: 2px; }

/* Minimal UI bar (Check/Reset) — small, non-intrusive */
#uiBar{
  position: fixed;
  right: 16px;
  bottom: 16px;
  display: flex; gap: .5rem;
  z-index: 12;
}
button{
  padding:.55rem 1rem; border:none; border-radius:.6rem;
  font-weight:700; font-size:.98rem; cursor:pointer;
  background: var(--accent); color:#fff;
  box-shadow: 0 3px 10px rgba(0,0,0,.12);
}
button.secondary{ background: var(--charcoal); }
button:disabled{ opacity:.6; cursor:not-allowed; }

/* ==========================
   Comma Bank (infinite commas)
========================== */
#bank{
  display:flex; flex-wrap:wrap; gap:.5rem;
  min-height: 70px; padding:.6rem;
  background: #fff2f6e0;        /* translucent so printed bank shows through */
  border: 2px dashed rgba(0,0,0,.08);
  border-radius: .8rem;
  backdrop-filter: blur(1px);
}
.token{
  display:inline-flex; align-items:center; justify-content:center;
  padding:.35rem .5rem;
  font: 900 var(--comma-size)/1 var(--comma-font); /* match commas */
  color: var(--comma-color);
  background:#fff; border:2px solid var(--accent); border-radius:.6rem;
  cursor:grab; user-select:none;
  box-shadow: 0 2px 6px rgba(0,0,0,.10);
}

/* ==========================
   Sentences
========================== */
.sentence-row{
  display:flex; align-items:baseline; gap:.5rem;
  margin-bottom: .65rem;
  /* transparent row so the image remains visible */
}
.number{
  font-weight:800; font-size:1.2rem; color: var(--latte);
  width: 2ch; text-align: right;
}

/* The text line itself */
.line{
  flex: 1 1 auto;
}

/* Each word is a drop target */
.word{
  display:inline-block; position:relative; padding:.05rem .2rem;
}
.word.drop-target{
  outline: 3px dashed var(--accent);
  outline-offset: 2px;
  border-radius: .25rem;
  background: #fff5fb;
}

/* Underline the intro phrase (visual support) */
.intro{
  text-decoration: underline wavy var(--sage) 2px;
  text-underline-offset: 4px;
  background: #f0f7f1d0;
  border-radius:.2rem; padding: 0 .15rem;
}

/* The dropped comma */
.comma-here{
  display:inline-block;
  font: 900 var(--comma-size)/1 var(--comma-font);
  color: var(--comma-color);
  cursor:pointer;
  margin-left:.12rem;
}

/* Lock / Unlock Answer toggle */
.lock-wrap{
  margin-left: .5rem;
}
.lock-btn{
  background:#ffffffd9; color:#222; border:1px solid #e5e7eb;
  padding:.35rem .6rem; border-radius:.5rem; font-weight:800;
  box-shadow: 0 1px 4px rgba(0,0,0,.08);
}
.locked .lock-btn{
  background:#eef8ff; border-color:#cfeaff; color:#174b7a;
}

/* Feedback on CHECK */
.correct{
  background:#ecf8ec !important;
  box-shadow: inset 0 0 0 2px var(--good);
}
.incorrect{
  background:#ffe6ef !important;
  box-shadow: inset 0 0 0 2px var(--bad);
}

/* Shake animation for incorrect */
@keyframes shake {
  10%, 90% { transform: translateX(-2px); }
  20%, 80% { transform: translateX(3px); }
  30%, 50%, 70% { transform: translateX(-5px); }
  40%, 60% { transform: translateX(5px); }
}
.shake { animation: shake .45s ease both; }

.results{
  position: fixed;
  right: 16px; bottom: 60px;
  font-weight: 800; z-index: 12;
  color: #1f2937;
  text-shadow: 0 1px 0 #fff;
}

/* Phones: stack overlays full width so it’s usable */
@media (max-width: 900px){
  #sentencesLayer{
    top: 52%;
    left: 6%;
    width: 88%;
  }
  #bankLayer{
    top: 8%;
    left: 6%;
    width: 88%;
  }
}
</style>
</head>

<body>
  <!-- Background stays exactly as-is -->
  <div class="bg" aria-hidden="true"></div>

  <!-- ====== INTERACTIVE OVERLAYS ONLY ====== -->

  <!-- Comma bank overlay: position over the printed bank area -->
  <section id="bankLayer" aria-label="Comma bank">
    <div id="bank"></div>
  </section>

  <!-- Sentences overlay (transparent rows only) -->
  <section id="sentencesLayer" aria-live="polite"></section>

  <!-- Minimal UI: Check (gated) + Reset -->
  <div id="uiBar">
    <button id="checkBtn" disabled>Check</button>
    <button id="resetBtn" class="secondary">Reset</button>
  </div>
  <div id="score" class="results"></div>

<script>
/* =========================================================
   DATA: two rounds; beginning=true means comma is required
   after the intro phrase; beginning=false means no comma.
========================================================= */
const ROUNDS = [
  {
    name: "Round 1",
    items: [
      { id:"1", intro:"After the final bell", rest:"the hallway exploded with chatter.", beginning:true },
      { id:"2", intro:"In the early morning", rest:"the stadium lights still glowed.", beginning:true },
      { id:"3", intro:"Before the science quiz", rest:"Mia reviewed her notes.", beginning:true },
      { id:"4", intro:"With a nervous smile", rest:"Jordan stepped onto the stage.", beginning:true },

      { id:"5", before:"The hallway exploded with chatter", intro:"after the final bell.", beginning:false },
      { id:"6", before:"The stadium lights still glowed", intro:"in the early morning.", beginning:false },
      { id:"7", before:"Mia reviewed her notes", intro:"before the science quiz.", beginning:false },
      { id:"8", before:"Jordan stepped onto the stage", intro:"with a nervous smile.", beginning:false }
    ]
  },
  {
    name: "Round 2",
    items: [
      { id:"1", intro:"During the thunderstorm", rest:"we sheltered under the awning.", beginning:true },
      { id:"2", intro:"On the bus ride home", rest:"I finished Chapter Five.", beginning:true },
      { id:"3", intro:"At the edge of the field", rest:"a hawk hovered low.", beginning:true },
      { id:"4", intro:"Without warning", rest:"the lights flickered and went out.", beginning:true },

      { id:"5", before:"We sheltered under the awning", intro:"during the thunderstorm.", beginning:false },
      { id:"6", before:"I finished Chapter Five", intro:"on the bus ride home.", beginning:false },
      { id:"7", before:"A hawk hovered low", intro:"at the edge of the field.", beginning:false },
      { id:"8", before:"The lights flickered and went out", intro:"without warning.", beginning:false }
    ]
  }
];

/* ====== STATE ====== */
let currentRoundIndex = 0;
const placements = new Map();  // sid -> index or null
const locked = new Set();      // sid of locked sentences

/* ====== HELPERS ====== */
const $ = sel => document.querySelector(sel);
function wordIndexForCommaAfterIntro(item){ return item.intro.split(' ').length - 1; }

/* ====== BUILD BANK (infinite commas) ====== */
function buildBank(){
  const bank = $("#bank");
  bank.innerHTML = "";
  // visually plenty; logically infinite because tokens remain
  for(let i=0;i<14;i++){
    const t = document.createElement("div");
    t.className = "token";
    t.textContent = ",";
    t.draggable = true;
    t.addEventListener("dragstart", e => {
      e.dataTransfer.setData("text/plain", "comma");
    });
    bank.appendChild(t);
  }
}

/* ====== BUILD SENTENCES ====== */
function buildSentences(){
  const wrap = $("#sentencesLayer");
  wrap.innerHTML = "";
  placements.clear();
  locked.clear();
  updateCheckEnabled();

  const round = ROUNDS[currentRoundIndex];

  round.items.forEach(item => {
    const row = document.createElement("div");
    row.className = "sentence-row";
    row.dataset.sid = item.id;

    // Number only
    const num = document.createElement("span");
    num.className = "number";
    num.textContent = item.id + ".";
    row.appendChild(num);

    // Text line (words = drop targets)
    const line = document.createElement("span");
    line.className = "line";

    const words = item.beginning
      ? (item.intro + " " + item.rest).split(" ")
      : (item.before + " " + item.intro).split(" ");

    words.forEach((w,i) => {
      const span = document.createElement("span");
      span.className = "word";
      span.textContent = w + " ";
      span.dataset.sid = item.id;
      span.dataset.index = String(i);
      makeDropzone(span);
      line.appendChild(span);
    });

    // Highlight the intro phrase range for visual support
    if(item.beginning){
      const introLen = item.intro.split(" ").length;
      for(let i=0;i<introLen;i++){
        const target = line.querySelector(`.word[data-index="${i}"]`);
        if(target) target.classList.add("intro");
      }
    } else {
      const beforeLen = item.before.split(" ").length;
      for(let i=beforeLen;i<words.length;i++){
        const target = line.querySelector(`.word[data-index="${i}"]`);
        if(target) target.classList.add("intro");
      }
    }

    row.appendChild(line);

    // Lock/Unlock
    const lockWrap = document.createElement("span");
    lockWrap.className = "lock-wrap";
    const lockBtn = document.createElement("button");
    lockBtn.className = "lock-btn";
    lockBtn.textContent = "Lock answer";
    lockBtn.addEventListener("click", () => toggleLock(item.id, row, lockBtn));
    lockWrap.appendChild(lockBtn);
    row.appendChild(lockWrap);

    wrap.appendChild(row);
    // default: no comma placed
    placements.set(item.id, null);
  });

  // fresh bank each build
  buildBank();
  $("#score").textContent = "";
}

/* ====== DROP/REMOVE COMMAS ====== */
function makeDropzone(node){
  node.addEventListener("dragover", e => {
    e.preventDefault();
    const sid = node.dataset.sid;
    if(locked.has(sid)) return;  // ignore when locked
    node.classList.add("drop-target");
  });
  node.addEventListener("dragleave", () => node.classList.remove("drop-target"));

  node.addEventListener("drop", e => {
    e.preventDefault();
    node.classList.remove("drop-target");
    const sid = node.dataset.sid;
    const idx = parseInt(node.dataset.index, 10);

    if(locked.has(sid)) return;  // ignore when locked

    // Remove any existing comma in this sentence
    document.querySelectorAll(`.comma-here[data-sid="${sid}"]`).forEach(c => c.remove());

    // Insert new comma
    const comma = document.createElement("span");
    comma.className = "comma-here";
    comma.dataset.sid = sid;
    comma.textContent = ",";
    // click to remove (only when unlocked)
    comma.addEventListener("click", () => {
      if(locked.has(sid)) return;
      comma.remove();
      placements.set(sid, null);
      // do not need to add back to bank (bank is infinite)
    });

    node.appendChild(comma);
    placements.set(sid, idx);
  });
}

/* ====== LOCK / UNLOCK ====== */
function toggleLock(sid, row, btn){
  if(locked.has(sid)){
    // Unlock
    locked.delete(sid);
    row.classList.remove("locked");
    btn.textContent = "Lock answer";
    // Allow editing again
  } else {
    // Lock
    locked.add(sid);
    row.classList.add("locked");
    btn.textContent = "Unlock answer";
  }
  updateCheckEnabled();
}

function updateCheckEnabled(){
  const round = ROUNDS[currentRoundIndex];
  const allLocked = locked.size === round.items.length;
  $("#checkBtn").disabled = !allLocked;
}

/* ====== CHECK (green for correct, red+shake for wrong) ====== */
function checkAnswers(){
  // Clear previous markings
  document.querySelectorAll(".word").forEach(w => w.classList.remove("correct","incorrect","shake"));
  document.querySelectorAll(".sentence-row").forEach(r => r.classList.remove("correct","incorrect","shake"));

  const round = ROUNDS[currentRoundIndex];
  let correct = 0, total = round.items.length;

  round.items.forEach(item => {
    const sid = item.id;
    const placed = placements.get(sid);     // index or null

    if(item.beginning){
      const should = wordIndexForCommaAfterIntro(item);
      if(placed === should){
        // correct: highlight the boundary word
        const target = document.querySelector(`.word[data-sid="${sid}"][data-index="${should}"]`);
        if(target) target.classList.add("correct");
        correct++;
      } else {
        // wrong: shake + red at student's placed spot (if any) and target
        if(placed !== null){
          const wrong = document.querySelector(`.word[data-sid="${sid}"][data-index="${placed}"]`);
          if(wrong){ wrong.classList.add("incorrect","shake"); }
        }
        const target = document.querySelector(`.word[data-sid="${sid}"][data-index="${should}"]`);
        if(target){ target.classList.add("incorrect","shake"); }
      }
    } else {
      // ending → no comma should be present
      if(placed === null){
        // mark row as correct (no single word to paint)
        const row = document.querySelector(`.sentence-row[data-sid="${sid}"]`);
        if(row) row.classList.add("correct");
        correct++;
      } else {
        const wrong = document.querySelector(`.word[data-sid="${sid}"][data-index="${placed}"]`);
        if(wrong){ wrong.classList.add("incorrect","shake"); }
      }
    }
  });

  $("#score").textContent = `${correct}/${total} correct`;
  // After check, students can still Unlock, fix, Lock, and re-Check (your choice A)
}

/* ====== RESET ====== */
function resetAll(){
  buildSentences();
  // keep round 1 as default; if you want a Round toggle later, we can add it back easily
}

/* ====== DEBUG OUTLINE (optional) ====== */
(function setDebugFromQuery(){
  const params = new URLSearchParams(location.search);
  if(params.get("debug") === "1"){
    document.body.classList.add("debug");
  }
})();

/* ====== INIT ====== */
buildSentences();

// Buttons
$("#checkBtn").addEventListener("click", checkAnswers);
$("#resetBtn").addEventListener("click", resetAll);
</script>
</body>
</html>
